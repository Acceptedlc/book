# CRM重构白皮书


### 前世今生

不知不觉中CRM系统已经快要1岁了。在这几个月的时间里，整个团队完成了从0到1，从1到N的过程，这是值得肯定的地方。

但是，正如同中国的经济一样，在经历过高速的发展期后，必然需要停顿那么一下，来进行产业结构的调整，我们的系统也是一样的。目前系统的库扩展性跟可维护性都已经亮起了红灯，下面我将从几个不同的角度总结一下现在系统的主要矛盾。然后，对症下药，提出重构方案。

* 需求管理方面
	*  首先，对于需求的讨论不够。合理的需求实现了，不合理的需求也实现了。
	*  第二，某些需求实现的方法不正确。使用方提供的需求，是非常感性的。我们需要对这些需求进行抽象与归纳，然后才是具体的实现，这一步是缺失的。
	*  第三，需求无文档。这直接导致无法进行系统的分析。

* 技术方面
	* __系统结构设计不合理，充分的展现了低内聚，高耦合的特点。__（比如，clue的create操作，散落在每一个业务逻辑中，当需要添加默认数值的时候，需要在整个项目中寻找所有的sql操作，进行修改。再比如，在clue的创建方法中还有创建操作日志的动作。还有，由于缺乏统一的设计跟管理，系统的中存在大量的功能相同的代码等等）
	* __采用技术老旧。__（比如：使用的bodyParser无法自动完成序列化与反序列化。这种公共的东西还需要出现在业务代码当中等）
	* __api设计混乱。__ （比如：clue的put操作，出现了各种不同的api。前端还需要给每个api传递不同格式的参数）
	* __权限系统接近崩溃。__ 原有的权限的设计依然不能满足现有的也无需求，

综上所述，我认为重构可以需要经过一下几个步骤：  

1. 对现有需求进行充分的扬弃。充分的讨论每个需求的必要性，实现方式，最终形成一个完整的需求文档。
2. 根据step one形成需求文档，进行系统设计。
3. 定制迁移方案，逐步开发并废弃原有的系统。

### 需求整理与批判

#### 市场活动

*  __创建市场活动__
	* 活动主题为不可重复字段
	* 活动日期，预算部门负责人，活动主题，信息来源，省，市为必填字段
	* 保存按钮的市场活动还可以修改。
	* 保存并提交的市场活动用户不能再次编辑其内容了，并且需要记录市场活动日志。
* __市场活动列表__
	* 用户只能查看自己跟自己下级的市场活动
* __审批市场活动__
	*  从市场活动列表页面，点击查看，然后进入详情页，点击批准跟拒绝（用户只能审批自己跟下级的市场活动）
	*  被拒绝的市场活动，将会解锁，可以再次进行编辑跟提交
	*  无论批准还是拒绝都需要记录市场活动日志
* __总结市场活动__
	* 跟审批一样，只能总结自己的跟下级的。具体就是填写一个表单，保存到数据库。
* __市场活动活动结果导入__
	* 	选择市场活动（只能选择自己跟自己下级的）
	*  选择csv
	*  点击导入
	*  对于每一条导入数据，如果没有学生就创建学生，如果没有未关闭状态的工单，商机就创建一个工单，责任人就是导入的操作人，最后创建市场活动明细
* __市场活动活动结果列表__
	*  只能查看自己跟自己下级的市场活动明细
* __市场活动活动结果创建__
	* 选择市场活动（只能是自己跟自己下级的）
	* 填写信息，具体创建规则见导入市场活动结果

### 市场部商机

* 分配商机
	* 为什么可以看到不是自己跟自己下级的数据

	



